<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Guess the Photo Location</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      body {
          font-family: Arial, sans-serif;
          margin: 20px;
          display: flex;
          flex-direction: row; /* Side-by-side layout */
          align-items: center;
          gap: 20px;
      }
      #photo-container {
          flex: 2; /* Large photo area */
          text-align: center;
      }
      #photo img {
          max-width: 100%;
          height: auto;
          display: block;
          margin: 0 auto;
          border: 2px solid black;
      }
      #map-container {
          flex: 1; /* Smaller map area */
          display: flex;
          flex-direction: column;
          align-items: center;
      }
      #map {
          width: 400px;  /* Larger map */
          height: 400px;
          border: 2px solid black;
      }
      button {
          margin-top: 10px;
          padding: 10px;
          font-size: 16px;
      }
      #result {
          margin-top: 10px;
          font-weight: bold;
      }
    </style>
</head>
<body>
    <!-- Left Side: Large Photo -->
    <div id="photo-container">
        <h1>Where is this room?</h1>
        <img src="/static/images/room331.jpg" alt="Room331 Photo">
    </div>

    <!-- Right Side: Interactive Map -->
    <div id="map-container">
        <h2>Click on the map</h2>
        <div id="map"></div>
        <button id="submitGuess" disabled>Submit Guess</button>
        <p id="result"></p>
        <p><a href="/">Back to Home</a></p>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        var map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -2,  // Allow zooming out
            maxZoom: 2,   // Allow zooming in
            zoomControl: true
        });

        // Image dimensions
        var imgWidth = 2000, imgHeight = 1500;
        var imageUrl = '/static/images/school_plan.jpg';

        // Define map bounds based on image size
        var southWest = map.unproject([0, imgHeight], map.getMaxZoom());
        var northEast = map.unproject([imgWidth, 0], map.getMaxZoom());
        var bounds = new L.LatLngBounds(southWest, northEast);

        // Add image as map background
        L.imageOverlay(imageUrl, bounds).addTo(map);
        map.fitBounds(bounds);

        // True location of Room 331 in pixels (adjust as needed)
        var truePixel = [1200, 800];
        var trueLatLng = map.unproject(truePixel, map.getMaxZoom());

        var guessMarker = null;
        var guessLatLng = null;

        // Allow clicking on the map to place a guess
        map.on('click', function(e) {
            guessLatLng = e.latlng;
            if (guessMarker) {
                map.removeLayer(guessMarker);
            }
            guessMarker = L.marker(guessLatLng).addTo(map);
            document.getElementById("submitGuess").disabled = false;
        });

        // Calculate distance between guess and correct location
        function computeDistance(latlng1, latlng2) {
            return latlng1.distanceTo(latlng2);
        }

        // Submit button logic
        document.getElementById("submitGuess").addEventListener("click", function() {
            if (!guessLatLng) return;
            var distance = computeDistance(guessLatLng, trueLatLng);
            document.getElementById("result").textContent =
                "Your guess is " + Math.round(distance) + " pixels away from the correct location.";
        });
    </script>
</body>
</html>